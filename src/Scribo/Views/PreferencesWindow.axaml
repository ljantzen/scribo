<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Scribo.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="600"
        x:Class="Scribo.Views.PreferencesWindow"
        x:DataType="vm:PreferencesViewModel"
        Title="Application Preferences"
        Width="600" Height="600"
        WindowStartupLocation="CenterOwner">
    
    <ScrollViewer>
        <StackPanel Margin="20" Spacing="15">
            <!-- Auto-Save Settings Section -->
            <TextBlock Text="Auto-Save Settings" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
            
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <CheckBox Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
                         Content="Enable Auto-Save"
                         IsChecked="{Binding AutoSave, Mode=TwoWay}"
                         Margin="0,0,0,10"/>

                <TextBlock Grid.Row="1" Grid.Column="0" 
                          Text="Auto-Save Interval (minutes):" 
                          VerticalAlignment="Center" 
                          Margin="0,0,10,10"
                          IsVisible="{Binding AutoSave}"/>
                <NumericUpDown Grid.Row="1" Grid.Column="1" 
                              Value="{Binding AutoSaveIntervalMinutes, Mode=TwoWay}"
                              Minimum="1"
                              Maximum="60"
                              FormatString="N0"
                              Margin="0,0,0,10"
                              IsVisible="{Binding AutoSave}"/>
            </Grid>

            <!-- Backup Settings Section -->
            <TextBlock Text="Backup Settings" FontSize="16" FontWeight="Bold" Margin="0,10,0,10"/>
            
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <CheckBox Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
                         Content="Create Backup on Save"
                         IsChecked="{Binding BackupOnSave, Mode=TwoWay}"
                         Margin="0,0,0,10"/>

                <TextBlock Grid.Row="1" Grid.Column="0" 
                          Text="Maximum Backups:" 
                          VerticalAlignment="Center" 
                          Margin="0,0,10,10"
                          IsVisible="{Binding BackupOnSave}"/>
                <NumericUpDown Grid.Row="1" Grid.Column="1" 
                              Value="{Binding MaxBackups, Mode=TwoWay}"
                              Minimum="1"
                              Maximum="100"
                              FormatString="N0"
                              Margin="0,0,0,10"
                              IsVisible="{Binding BackupOnSave}"/>
            </Grid>

            <!-- Editor Settings Section -->
            <TextBlock Text="Editor Settings" FontSize="16" FontWeight="Bold" Margin="0,10,0,10"/>
            
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Grid.Column="0" Text="Default Font Family:" VerticalAlignment="Center" Margin="0,0,10,10"/>
                <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding DefaultFontFamily, Mode=TwoWay}" Margin="0,0,0,10"/>

                <TextBlock Grid.Row="1" Grid.Column="0" Text="Default Font Size:" VerticalAlignment="Center" Margin="0,0,10,10"/>
                <NumericUpDown Grid.Row="1" Grid.Column="1" 
                              Value="{Binding DefaultFontSize, Mode=TwoWay}"
                              Minimum="8"
                              Maximum="72"
                              FormatString="N0"
                              Margin="0,0,0,10"/>

                <CheckBox Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                         Content="Word Wrap"
                         IsChecked="{Binding WordWrap, Mode=TwoWay}"
                         Margin="0,0,0,10"/>

                <CheckBox Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                         Content="Show Line Numbers"
                         IsChecked="{Binding ShowLineNumbers, Mode=TwoWay}"
                         Margin="0,0,0,10"/>

                <CheckBox Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2"
                         Content="Show Ruler"
                         IsChecked="{Binding ShowRuler, Mode=TwoWay}"
                         Margin="0,0,0,10"/>
            </Grid>

            <!-- Status Bar Settings Section -->
            <TextBlock Text="Status Bar Settings" FontSize="16" FontWeight="Bold" Margin="0,10,0,10"/>
            
            <StackPanel Spacing="5">
                <CheckBox Content="Show Word Count in Status Bar"
                         IsChecked="{Binding ShowWordCountInStatusBar, Mode=TwoWay}"/>
                <CheckBox Content="Show Character Count in Status Bar"
                         IsChecked="{Binding ShowCharacterCountInStatusBar, Mode=TwoWay}"/>
                <CheckBox Content="Show Page Count in Status Bar"
                         IsChecked="{Binding ShowPageCountInStatusBar, Mode=TwoWay}"/>
            </StackPanel>

            <!-- Theme Settings Section -->
            <TextBlock Text="Appearance" FontSize="16" FontWeight="Bold" Margin="0,10,0,10"/>
            
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="Theme:" VerticalAlignment="Center" Margin="0,0,10,10"/>
                <ComboBox Grid.Column="1" 
                         SelectedItem="{Binding Theme, Mode=TwoWay}"
                         Margin="0,0,0,10">
                    <ComboBox.Items>
                        <x:String>Light</x:String>
                        <x:String>Dark</x:String>
                    </ComboBox.Items>
                </ComboBox>
            </Grid>

            <!-- Keyboard Shortcuts Section -->
            <TextBlock Text="Keyboard Shortcuts" FontSize="16" FontWeight="Bold" Margin="0,10,0,10"/>
            
            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                   BorderThickness="1"
                   Padding="5"
                   MaxHeight="300">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding KeyboardShortcuts}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="vm:KeyboardShortcutViewModel">
                                <Grid Margin="0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Column="0" 
                                              Text="{Binding DisplayName}" 
                                              VerticalAlignment="Center"
                                              Margin="5,0"/>
                                    
                                    <TextBlock Grid.Column="1" 
                                              Text=":" 
                                              VerticalAlignment="Center"
                                              Margin="5,0"/>
                                    
                                    <TextBox Grid.Column="2" 
                                            Text="{Binding Shortcut, Mode=TwoWay}" 
                                            VerticalAlignment="Center"
                                            Margin="5,0"
                                            Watermark="Press keys or type..."
                                            KeyDown="OnShortcutKeyDown"
                                            GotFocus="OnShortcutGotFocus"
                                            LostFocus="OnShortcutLostFocus"
                                            KeyUp="OnShortcutKeyUp"/>
                                    
                                    <Button Grid.Column="3"
                                           Content="Reset"
                                           Click="OnResetShortcutClick"
                                           Margin="5,0"
                                           Padding="10,2"
                                           FontSize="11"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>

            <!-- Buttons -->
            <StackPanel Orientation="Horizontal" 
                       HorizontalAlignment="Right" 
                       Spacing="10" 
                       Margin="0,20,0,0">
                <Button Content="Cancel" 
                        Command="{Binding CancelCommand}"
                        Width="100"
                        IsCancel="True"
                        Click="OnCancelClick"/>
                <Button Content="OK" 
                        Command="{Binding SaveCommand}"
                        Width="100"
                        IsDefault="True"
                        Click="OnOkClick"/>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</Window>
